extends ./layout.pug
include _tableMixins

mixin rows(assets, showTiming)
  - const t = translations || {}
  each asset in assets
    tr
      td.url.assetsurl(data-title=(t && t['table.url']) ? t['table.url'] : 'URL')
        a(href=asset.url)= h.shortAsset(asset.url)
        | &nbsp;
        a(href=asset.runPage + '.html') &circlearrowleft;
      +durationCell((t && t['table.lastModified']) ? t['table.lastModified'] : 'last modified',asset.lastModification)
      +durationCell((t && t['table.cacheTime']) ? t['table.cacheTime'] : 'cache time',asset.cacheTime)
      +kbSizeCell((t && t['table.transfer']) ? t['table.transfer'] : 'transfer', asset.transferSize)
      +kbSizeCell((t && t['table.size']) ? t['table.size'] : 'size', asset.contentSize)
      if showTiming
        +numberCell((t && t['table.timing']) ? t['table.timing'] : 'timing', asset.totalTime.toFixed(0))

block content
  - const t = translations || {}
  include runInfo

  if (assetsBySize)
    - const topLists = ['javascript', 'image', 'css', 'html'];
    - const contentTypeNames = {javascript: 'JavaScript', image: 'image' , css: 'CSS', html : 'HTML'}
    ul
      li.group-item.active Quick links
      each type in topLists
        if (assetsBySize[type] && assetsBySize[type].length > 1)
          li.group-item
            a(href='#' + type) Largest #{contentTypeNames[type]} files
      li.group-item
        a(href='#slowest') Slowest responses
      if options.firstParty
        li.group-item
          a(href='#slowestThirdParty') Slowest third party responses
        li.group-item
          a(href='#largestThirdParty') Largest third party responses
    each type in topLists
      if (assetsBySize[type] && assetsBySize[type].length > 1)
        h3(id=type) Largest #{contentTypeNames[type]} files
        .responsive
          table(data-sortable)
            +rowHeading([t['table.url'] || 'url', t['table.lastModified'] || 'time since last modified', t['table.cacheTime'] || 'cache time', t['table.transfer'] || 'transfer (kb)', t['table.size'] || 'size (kb)'])
            +rows(assetsBySize[type], false)

    h3 Slowest responses
    p These are the assets that took the longest time to download.
    .responsive
      table(data-sortable, id='slowest')
        +rowHeading([t['table.url'] || 'url', t['table.lastModified'] || 'time since last modified', t['table.cacheTime'] || 'cache time', t['table.transfer'] || 'transfer (kb)', t['table.size'] || 'size (kb)', t['table.timing'] || 'timing (ms)'])
        +rows(slowestAssets, true)
    if options.firstParty
      h3 3rd party largest responses
      .responsive
        table(data-sortable, id='largestThirdParty')
          +rowHeading([t['table.url'] || 'url', t['table.lastModified'] || 'time since last modified', t['table.cacheTime'] || 'cache time', t['table.transfer'] || 'transfer (kb)', t['table.size'] || 'size (kb)'])
          +rows(thirdPartyAssetsBySize, false)

      h3 3rd party slowest responses
      p These are the 3rd party assets that took the longest time to download.
      .responsive
        table(data-sortable, id='slowestThirdParty')
          +rowHeading([t['table.url'] || 'url', t['table.lastModified'] || 'time since last modified', t['table.cacheTime'] || 'cache time', t['table.transfer'] || 'transfer (kb)', t['table.size'] || 'size (kb)', t['table.timing'] || 'timing (ms)'])
          +rows(thirdPartySlowestAssets, true)
